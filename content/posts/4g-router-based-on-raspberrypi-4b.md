---
title: "åŸºäºæ ‘è“æ´¾4Bçš„4Gè·¯ç”±å™¨"
date: 2020-05-11T23:03:50+08:00
draft: true
toc: false
images:
tags: 
  - raspberrypi
---
## å‰è¨€ï¼ˆåºŸè¯ï¼‰

å…¬å¯“å®½å¸¦è´¨é‡å¤ªå·®ï¼Œå»¶è¿Ÿé«˜ä¸¢åŒ…é«˜ï¼Œå”¯ä¸€ç”¨å¤„å°±æ˜¯ç”¨æ¥ä¸‹è½½ä¸œè¥¿ã€‚ç§»åŠ¨æ•°æ®ç½‘ç»œè®¿é—®å¤šæ•°ç½‘ç«™æ—¶éƒ½èƒ½æ­£å¸¸æ‰“å¼€ï¼Œä½†æ˜¯å±‹å†…ä¿¡å·å·®ã€‚

æ‰‹æŒå°ç±³8ï¼Œå¾ˆå¤šæ—¶å€™4Gä¸Šç½‘éƒ½æˆé—®é¢˜ï¼Œæ›´æœ‰ç”šè€…â€”â€”ä¿¡å·å·®åˆ°æ— æ³•æ‹¨æ‰“ç”µè¯â€¦â€¦

ç›¸åï¼Œä¹‹å‰è¯•ç”¨è¿‡è£è€€9Xï¼Œå‘ç°åŒç­‰ç¯å¢ƒä¸‹ä¸ä»…èƒ½ä¸Šç½‘ï¼Œè€Œä¸”è¿˜æŒºæµç•…ï¼Œåœ¨å°ç±³8æ‰“ä¸å¼€ç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œè£è€€9Xä¸‹è½½Appé€Ÿåº¦èƒ½è¾¾åˆ°2M/sã€‚

2020å¹´ï¼Œ5Gæ­£å‘ˆç°é“ºå¤©ç›–åœ°æ°”åŠ¿ï¼Œæ‰‹æœºä»·æ ¼ä¹Ÿæœ‰äº†å¤§çš„è·ƒè¿›â€¦â€¦æˆ‘ä¸æ˜¯å¾ˆæƒ…æ„¿ä¸ºä¸€éƒ¨æ‰‹æœºæ”¯å‡ºä¸€å°ç¬”è®°æœ¬ç”µè„‘çš„è´¹ç”¨ã€‚

ä¹‹å‰æ‰‹å¤´æœ‰ä¸ªä¸ºæ ‘è“æ´¾è®¾è®¡çš„å¸¦æœ‰åä¸º4Gæ¨¡å—çš„USBç½‘å¡ï¼Œä½†æ˜¯æˆ‘éƒ½å¤šæ•°æ—¶é—´åªæ˜¯ç”¨æ¥æ’ç”µè„‘ä¸Šè¿›è¡Œç§»åŠ¨ç½‘ç»œä¸Šç½‘ã€‚å…¶å®æˆ‘æ›´å¸Œæœ›æ‰‹æœºã€å¹³æ¿ã€ç”µè„‘éƒ½èƒ½åŒæ—¶ä½¿ç”¨è¿™ä¸ªç§»åŠ¨ç½‘ç»œä¸Šç½‘ã€‚äºæ˜¯è¯ç”Ÿäº†ç”¨æ ‘è“æ´¾åšä¸ª4Gè·¯ç”±çš„æƒ³æ³•ã€‚

## å®ç°æ­¥éª¤

### ç¡¬ä»¶å‡†å¤‡

> æˆ‘å¹¶ä¸æ˜¯ä¸ºäº†å®ç° 4G è·¯ç”±åŠŸèƒ½å»ä¹°çš„ç›¸å…³é…ä»¶ï¼Œç›¸åå› ä¸ºå®ƒä»¬éƒ½å¤„äºé—²ç½®çŠ¶æ€ï¼Œæ‰€ä»¥èŒç”Ÿäº†è¿™ä¸ª DIY æƒ³æ³•ã€‚

ç¡¬ä»¶è®¾å¤‡åˆ—è¡¨

+ æ ‘è“æ´¾4B - 250 RMB
+ Mcuzone æ ‘è“æ´¾ 4G æ¨¡å—å¥—é¤ï¼ˆå«åä¸º ME909s-821a æ¨¡å—ã€å¤©çº¿ã€é©±åŠ¨æ¿ï¼‰ - 260 RMB

Mcuzone 4G å¥—é¤ä»·æ ¼åè´µï¼Œå®é™…ä¸Šå¯ä»¥å•ç‹¬è´­ä¹° ME909s-821a æ¨¡å—ï¼ˆ140 RMBï¼‰ä»¥åŠ 4G æ¨¡å—è½¬æ¥æ¿ï¼ˆ30 RMBï¼‰è¿›è¡Œæ­é…ä½¿ç”¨ã€‚

### ç½‘å¡æ‹¨å·

ç½‘å¡æ‹¨å·æ“ä½œä¸»è¦åˆ†ä¸º 3 ç§æ–¹å¼:

+ MBIM
+ NCM
+ PPP

é¦–å…ˆå°† USB ç½‘å¡æ’å…¥æ ‘è“æ´¾åï¼Œé€šè¿‡ `lsusb` æ£€æŸ¥è®¾å¤‡æ˜¯å¦è¢«æ­£å¸¸è¯†åˆ«ï¼Œè¾“å‡ºç»“æœç§åº”å½“åŒ…å« `Huawei Technology...` å­—æ®µã€‚

ä¸ºäº†é€‰æ‹©åˆé€‚çš„æ‹¨å·æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨ `ls /dev | grep cdc-wdm*` æ£€æŸ¥ç½‘å¡æ˜¯å¦ä»¥ MBIM æ¨¡å¼è¿æ¥åˆ°ç³»ç»Ÿã€‚

å¦‚æœè¾“å‡ºç»“æœå‡ºç° `cdc-wdm0` ç±»ä¼¼å­—æ®µï¼Œåˆ™é€‰ç”¨ MBIM æ–¹å¼è¿›è¡Œæ‹¨å·ä¸Šç½‘ã€‚

å¦åˆ™è¾“å…¥ `ls /dev | grep ttyUSB*` æ£€æŸ¥ç½‘å¡æ˜¯å¦è¢«è¯†åˆ«æˆäº†è™šæ‹Ÿä¸²å£æ¨¡å¼ã€‚

å¦‚æœå‡ºç°äº† `ttyUSB0 ttyUSB1 ttyUSB2 ttyUSB3 ttyUSB4` å­—æ®µï¼Œåˆ™è¡¨æ˜ç½‘å¡ä¸ºè™šæ‹Ÿä¸²å£æ¨¡å¼ï¼Œå¯é‡‡ç”¨ NCM æˆ–è€… PPP æ–¹å¼è¿›è¡Œæ‹¨å·ä¸Šç½‘ã€‚

#### MBIM

é¦–å…ˆå®‰è£…ä¾èµ–å¹¶æ–°å»ºé…ç½®æ–‡ä»¶
```
# å®‰è£…ä¾èµ–
sudo apt install libmbim-utils -y

# ç¼–è¾‘é…ç½®æ–‡ä»¶
sudo vim /etc/mbim-network.conf
```

å‘é…ç½®æ–‡ä»¶å†™å…¥å†…å®¹
```
APN=internet
APN_USER=
APN_PASS=
APN_AUTH=
PROXY=yes
```

è¿æ¥è‡³ç½‘ç»œ
```
sudo mbim-network /dev/cdc-wdm0 start
```

> è¯•è¿‡äº† 2019-07 ~ 2020-02 ç‰ˆæœ¬çš„ Raspbian ç³»ç»Ÿï¼ŒUSB ç½‘å¡æ’ä¸Šæ ‘è“æ´¾åå‡å§‹ç»ˆæ— æ³•è¯†åˆ«æˆ MBIM è™šæ‹Ÿç½‘å¡ï¼Œåªèƒ½çœ‹åˆ° ttyUSB è§„æ ¼è®¾å¤‡ã€‚

#### NCMæ–¹å¼

åˆ‡æ¢æ‹¨å·æ¨¡å¼åŠè¿æ¥è‡³ç½‘ç»œ
```
# åˆ‡æ¢æ‹¨å·æ¨¡å¼
sudo echo 'AT^NDISDUP=1,1' > /dev/ttyUSB2
# è·å– IP
sudo dhclient usb0 -v
```

æ£€æŸ¥ç½‘ç»œæ¥å£æƒ…å†µï¼Œæ³¨æ„æŸ¥çœ‹ `usb0` ï¼ˆä¸€èˆ¬æ˜¯è¿™ä¸ªï¼‰æ¥å£ä¿¡æ¯
```
ifconfig
```

#### PPPæ–¹å¼
> è„šæœ¬æ–‡ä»¶åœ°å€ğŸ‘‡
> 
> é“¾æ¥ï¼šhttps://pan.baidu.com/s/1rLvY6MfnY9XpNyKg1IGHyw æå–ç ï¼šcoxd 

å®‰è£…ä¾èµ–
```
sudo apt install pppd -y
```

å¤åˆ¶è„šæœ¬æ–‡ä»¶è‡³ pppd ä¸‹ç›®å½•
```
sudo cp huawei-dial huawei-chat /etc/pppd/peers
```

è¿æ¥è‡³ç½‘ç»œ
```
sudo pppd call huawei-dial &
```

æ£€æŸ¥ç½‘ç»œæ¥å£ï¼Œæ³¨æ„æŸ¥çœ‹ `ppp0` ï¼ˆä¸€èˆ¬æ˜¯è¿™ä¸ªï¼‰æ¥å£ä¿¡æ¯
```
ifconfig
```

## å¼€å¯å¹¶è®¾ç½®çƒ­ç‚¹

`wlan0` å£é»˜è®¤æ˜¯ç”¨æ¥è¿æ¥ WiFI çš„ï¼Œå®ƒåœ¨è¯·æ±‚è¿æ¥æ—¶ä¼šä½¿ç”¨ DHCP æ–¹å¼ä»ç›®æ ‡è·¯ç”±è·å– IP åœ°å€ã€‚ç°åœ¨æ°æ°ç›¸åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ªæ¥å£ä¸ºæ— çº¿å®¢æˆ·ç»ˆç«¯æä¾›è®¿é—®å…¥å£ï¼Œæä¾› IP åœ°å€åˆ†é…åŠå…¶å®ƒæœåŠ¡ï¼Œæ‰€ä»¥éœ€è¦ç»™å®ƒè®¾ç½®ä¸€ä¸ªå›ºå®šçš„ IP åœ°å€ã€‚

æ‰“å¼€æ ‘è“æ´¾é»˜è®¤ dhcp é…ç½®æ–‡ä»¶
```
sudo vim /etc/dhcpcd.conf
```

åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¦‚ä¸‹å†…å®¹
```
interface wlan0
    static ip_address=192.168.1.1/24
    nohook wpa_supplicant
```

é»˜è®¤æƒ…å†µä¸‹ 2 ä¸ªç½‘ç»œä¹‹é—´æ˜¯ä¸ç›¸é€šçš„ã€‚ç°åœ¨æˆ‘ä»¬çš„æƒ…å†µæ˜¯ä½¿ç”¨ `usb0` æ¥å£è¿æ¥è‡³äº’è”ç½‘ï¼Œä½¿ç”¨ `wlan0` æ¥å£ä¸ä¼—å¤šå®¢æˆ·ç«¯ç›¸è¿æ¥ã€‚ä¸ºäº†ä½¿å¾—æ— çº¿ç½‘ç»œå…·å¤‡ç½‘ç»œè®¿é—®èƒ½åŠ›ï¼Œæˆ‘ä»¬éœ€è¦å°† `wlan0` ç«¯å£çš„æ•°æ®è½¬å‘è‡³ `usb0` æ¥å£å‘é€å‡ºè‡³äº’è”ç½‘ä¸Šã€‚

æ–°å»ºä¸€ä¸ªç³»ç»Ÿé…ç½®æ–‡ä»¶
```
sudo vim /etc/sysctl.d/routed-ap.conf
```

æ·»åŠ å¦‚ä¸‹å†…å®¹
```
net.ipv4.ip_forward=1
```

é…ç½®é˜²ç«å¢™çš„è½¬å‘ä¸ä¼ªè£…è§„åˆ™
```
sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```

é˜²ç«å¢™è§„åˆ™æŒä¹…åŒ–ï¼ˆå¦åˆ™æ¯æ¬¡é‡å¯åéƒ½ä¼šå¤±æ•ˆï¼‰
```
sudo DEBIAN_FRONTEND=noninteractive apt install -y netfilter-persistent iptables-persistent
sudo netfilter-persistent save
```

ä¸ºæ— çº¿çƒ­ç‚¹é…ç½® DHCP åŠ DNS æœåŠ¡
```
# å®‰è£… dnsmasq
sudo apt install dnsmasq -y

# å¤‡ä»½é»˜è®¤é…ç½®æ–‡ä»¶
sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig

# æ–°å»ºç©ºçš„é…ç½®æ–‡ä»¶
sudo nano /etc/dnsmasq.conf
```

å†™å…¥ä»¥ä¸‹å†…å®¹
```
interface=wlan0
dhcp-range=192.168.1.2,192.168.1.254,255.255.255.0,24h
domain=wlan
address=/gw.wlan/192.168.1.1
```

ä¸ºç¡®ä¿é¢‘ç‡ä½¿ç”¨ä¸è¢«é™åˆ¶ä½
```
sudo rfkill unblock wlan
```

é…ç½®æ— çº¿çƒ­ç‚¹ä¿¡æ¯
```
sudo vim /etc/hostapd/hostapd.conf
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼ˆè‡ªè¡Œæ›´æ”¹ `ssid` åŠ `wpa_passphrase`ï¼‰
```
country_code=US
interface=wlan0
ssid=NameOfNetwork
hw_mode=g
channel=7
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wpa=2
wpa_passphrase=AardvarkBadgerHedgehog
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
```

hw_modeå¯é€‰å€¼

+ a = IEEE 802.11a(5GHz)
+ b = IEEE 802.11b(2.4GHz)
+ g = IEEE 802.11g(2.4GHz)
+ ad = IEEE 802.11ad(80GHz)

é‡å¯å®Œæˆé…ç½®
```
sudo reboot
```

ä½¿ç”¨å…¶å®ƒè®¾å¤‡æœç´¢æ— çº¿ç½‘ç»œè¿›è¡Œè¿æ¥æµ‹è¯•

> ä¸Šè¿°ä¸»è¦å†…å®¹å‡æ‘˜æŠ„è‡³ç½‘ç»œï¼Œåªæ˜¯ç¨å¾®æ·»åŠ äº†ç‚¹è‡ªå·±çš„ç†è§£ã€‚

## å‚è€ƒèµ„æ–™

+ http://www.mcuzone.com/forum/forum.php?mod=viewthread&tid=34042&extra=page%3D2
+ http://www.mcuzone.com/forum/forum.php?mod=viewthread&tid=34040&extra=page%3D2
+ https://www.raspberrypi.org/documentation/configuration/wireless/access-point-routed.md

## ç»†èŠ‚ç†è§£

ä¸ç†è§£ `systemctl unmask hostapd` è¿™è¡Œå‘½ä»¤ï¼Ÿ

https://blog.csdn.net/stpice/article/details/104569146/